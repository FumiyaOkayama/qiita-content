---
title: AZ-204の演習についてまとめてみた
tags:
  - Azure
  - 資格
  - 試験対策
  - MicrosoftLearn
  - AZ-204
private: true
updated_at: '2025-09-15T23:12:28+09:00'
id: d8c294b1021957b212bb
organization_url_name: null
slide: false
ignorePublish: false
---
# Azure Developer Associate(AZ-204)の演習についてまとめてみた

本記事は、Azure Developer Associate (AZ-204) 試験の受験を考えている方、特に実践的な演習に焦点を当てて学習したい方向けの内容です。

:::note warn
Microsoft認定資格試験の問題内容は、[受験者契約](https://learn.microsoft.com/ja-jp/credentials/support/certification-exam-candidate-agreement)により第三者への開示が禁止されています。
本記事では具体的な問題内容には触れません。
また、一部AIツールを使用して生成した内容を含みます。
:::

## はじめに

筆者は AZ-204 試験で、特に**穴埋め問題・並び替え問題**に苦労し、一度不合格を経験しました。その経験から、Microsoft Learn の演習をしっかりと行うことの重要性を痛感しました。
本記事では、再受験に向けて取り組んだ演習の内容を、実践的な手順とともにまとめています。

## 公式リソース
- [試験 AZ-204: Microsoft Azure 向けソリューションの開発の学習ガイド](https://learn.microsoft.com/ja-jp/credentials/certifications/resources/study-guides/az-204)  
　→ 出題範囲や学習ポイントがまとまっています。
- [マイクロソフト認定: Azure 開発者アソシエイト](https://learn.microsoft.com/ja-jp/credentials/certifications/azure-developer/?practice-assessment-type=certification)  
　→ 試験概要や公式練習問題へのリンクがあります。

## 演習内容

### 事前準備

Azureの無料アカウントを新規作成します。最初の30日間は$300のクレジットがあるので、それを使用して演習を行いましょう。
https://azure.microsoft.com/ja-jp/pricing/purchase-options/azure-account

### Azure App Service

[演習 - Azure App Service のデプロイ スロットをスワップする](https://learn.microsoft.com/ja-jp/training/modules/understand-app-service-deployment-slots/4a-exercise-swap-deployment-slots)

**概要:** 静的 HTML ウェブサイトを Azure App Service にデプロイし、ステージング デプロイ スロットを作成する

:::note info
**試験対策:** App Serviceの主要コマンドまとめ
| コマンド | 役割 | 使い方/注意点 |
|:-:|:-:|:-:|
| az  webapp up | Webアプリの作成とデプロイを一括で行う | `--sku`で価格レベルを指定する。無料プラン(F1)はスロット非対応<br>`--html`で静的HTMLサイトとしてデプロイ |
| az webapp deployment slot create | デプロイスロットの作成 | `--slot`でスロット名を指定<br>スロット名は英数字とハイフンのみ使用可能 |
| az webapp deploy | Webアプリまたはスロットへのデプロイ | `--src-path`でデプロイするzipファイルを指定<br>`--slot`でスロット名を指定しない場合は本番スロットにデプロイ |
:::

<details><summary>デプロイスロット作成・スワップの詳細手順を見る</summary>

1. サンプルアプリのダウンロード
    [Azure Portal](https://portal.azure.com/)からクラウドシェルをクラシックバージョンで開き、サンプルアプリリポジトリをクローンする
        ```
        git clone https://github.com/Azure-Samples/html-docs-hello-world.git
        ```
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/3f675911-7c23-482d-8c96-971cb77cff85.png)

2. サンプルアプリのデプロイ
    - 変数の設定
        リソースグループとapp-nameを指定する
        ```bash
        resourceGroup=rg-mywebapp
        appName=mywebapp$RANDOM
        echo $appName
        ```
    - ディレクトリの移動・デプロイ
        ```bash
        cd html-docs-hello-world
        az provider register --namespace Microsoft.Web
        az webapp up -g $resourceGroup -n $appName --sku P0V3 --html
        ```      
        ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/44e56d0b-d1dc-456f-b359-0e817fd5bf0b.png)
        
        :::note warn
        公式の手順では `az provider register --namespace Microsoft.Web`という手順は無いですが、サブスクリプションにリソースプロバイダーが未登録でエラーになるので登録します。
        
3. デプロイされたWebアプリの確認
    PortalからApp Serviceを検索し、アプリがデプロイされていることを確認する
    アプリのプロパティのドメインから、対象ページにアクセスできることを確認する
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/8e825e18-eddf-437d-b767-8bc89e26904e.png)

4. デプロイスロットの作成
    次のコマンドを実行してデプロイスロットを作成する
        ```
        az webapp deployment slot create -n $appName -g $resourceGroup --slot staging
        ```
    新しいスロットの名前に「*-staging*」が追加されていることを確認する
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/9fd2a13c-bff3-4ad8-a201-888d20eb0709.png)

5. コードの更新
    `code index.html`でindex.htmlを開き、題名を「Azure App Service - Staging Slot」に編集して保存する
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/9a734b35-8772-4259-a2ef-c484b93a4977.png)

6. 更新したコードのステージングスロットへのデプロイ
    更新されたプロジェクトのzipファイルを作成する
        ```
        zip -r stagingcode.zip .
        ```
    ステージング スロットに更新をデプロイする
        ```
        az webapp deploy -g $resourceGroup -n $appName --src-path ./stagingcode.zip --slot staging
        ```

7. ステージングと本番のスロットの入れ替え
    [Source]に「*-staging*」のスロットを、[Target]に現在本番稼働しているスロットを選択し、スワップを開始する
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/c5d9c79d-9a54-4faa-936a-1c7aa95d98ea.png)
    本番のURLへ移動し、題名が変更されていることを確認する
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/fea7f8e3-b125-44f1-b0a6-3583857140d5.png)

8. リソースのクリーンアップ
   演習完了後は、不要な課金を防ぐためリソースグループごと削除してクリーンアップする

</details>


### Azure Functions

[演習 - Visual Studio Code を使用して Azure 関数を作成する](https://learn.microsoft.com/ja-jp/training/modules/develop-azure-functions/5-create-function-visual-studio-code)

**概要:** Visual Studio Code でローカルにコードを作成してテストした後、Azure に関数をデプロイする

<details><summary>VScodeからAzure Functionsにデプロイする詳細手順を見る</summary>

1. ローカルプロジェクトの作成
    [Ctrl]＋[Shift]＋p でコマンドパレットを開き、[Azure Functions: Create New Project...]を実行する
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/fbaead9e-778f-4cfb-b8a7-9ccaeeac3fc5.png)
    プロンプトに対して、公式ドキュメント通りに入力する
    入力後、指定したパス配下にプロジェクトが作成されている
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/647c9aa2-e59c-4dc4-a620-39dcd186ffee.png)

2. 関数をローカルで実行する
    ターミナルを開き、[F5キー]を押下してデバッガーで関数アプリプロジェクトを起動する
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/7bcb5a9e-3945-49e0-bd1c-975b7937ac47.png)
    HTTPトリガー関数のURLエンドポイントがローカルで実行されていることが確認できる

3. Azureでリソースを作成する
    VScodeのAzureの拡張機能タブからサインインして、新しくAzure Functionsのリソースを作成する
    プロンプトに対する入力内容は公式ドキュメント参照
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/1b78501e-d331-40f8-affa-5293483ca7c3.png)

4. プロジェクトをAzureにデプロイする
    [Ctrl]＋[Shift]＋p でコマンドパレットを開き、[Azure Functions: Deploy to Function App...]を実行する

5. Azureで関数を実行する
    VScodeのサイドバーのリソースエリアに戻り、関数を展開する。[HttpExample]をクリックし、[関数を今すぐに実行]を選択する

6. リソースのクリーンアップ
   演習完了後は、不要な課金を防ぐためリソースグループごと削除してクリーンアップする

</details>


### Azure Blob Storage

[演習 - .NET クライアント ライブラリを使用して BLOB ストレージ リソースを作成する](https://learn.microsoft.com/ja-jp/training/modules/work-azure-blob-storage/4-develop-blob-storage-dotnet)

**概要:** Azure Storage アカウントを作成し、Azure Storage Blob クライアント ライブラリを使用して .NET コンソール アプリケーションを構築する

::: note info
**試験対策:** SDKの主要クラスと代表メソッドまとめ
| クラス | 役割 | 代表メソッド | 使い方/注意点 |
|:-:|:-:|:-:|:-:|
| BlobServiceClient | ストレージアカウント全体のエントリポイント。エンドポイントと認証で作成する。 | GetBlobContainerClient, CreateBlobContainerAsync, GetAccountInfoAsync | アカウント単位の操作（コンテナ作成・一覧）。DefaultAzureCredential 等で初期化。|
| BlobContainerClient | 特定コンテナへの操作を提供するクライアント。 | CreateIfNotExistsAsync, DeleteAsync, GetBlobsAsync, GetBlobClient | コンテナ内の BLOB 操作の開始点。GetBlobsAsync は await foreach で列挙。 |
| BlobClient | 個々の BLOB（ファイル）に対するアップロード・ダウンロード・プロパティ操作を行う。 | UploadAsync, DownloadAsync, ExistsAsync, DeleteIfExistsAsync | ファイルのアップロード/ダウンロードに使用。大きいファイルは分割アップロードや UploadOptions を検討。 |
| BlobItem | GetBlobsAsync の列挙で取得する各 BLOB のメタデータ（名前・プロパティ等）。 | －（列挙で使用） | 列挙ループで blobItem.Name 等を参照。メタ確認に使用。 |
| BlobDownloadInfo | DownloadAsync の戻り値。コンテンツストリームやヘッダを含む。 | （プロパティ）Content, ContentType, ContentLength | download.Content を FileStream にコピーして保存。 |
:::

<details><summary>SDKを使用してコンテナ・BLOBを作成しローカルにダウンロードする手順を見る</summary>

1. Azure Storage アカウントの作成
    - Azure Portalから新しいクラウドシェルを作成し、Bashを選択してクラシックバージョンに移動する（※[Azure App Service](#Azure-App-Service)の手順1と同様です）
    - リソースグループを作成する
        ```bash
        az group create --location eastus2 --name myResourceGroup
        ```
    - 変数を設定する
        ```bash
        resourceGroup=myResourceGroup
        location=eastus
        accountName=storageacct$RANDOM$RANDOM
        ```
    - Azureストレージアカウントを作成する
        ```bash
        az storage account create --name $accountName \
            --resource-group $resourceGroup \
            --location $location \
            --sku Standard_LRS 

        echo $accountName
        ```
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/d8671ecb-475e-4d6c-a5c1-b59e688cf8c9.png)

    :::note warn
    公式の手順では `accountName=storageacct$RANDOM`というコマンドになっていますが、重複エラーが発生したので`accountName=storageacct$RANDOM$RANDOM`として回避しました。

2. .NETコンソールアプリを作成する
    - プロジェクトを作成するディレクトリの作成し、.NETコンソールアプリケーションを作成する
        ```bash
        mkdir azstore
        cd azstore
        dotnet new console
        ```
    - アプリケーションに必要なパッケージを追加する
        ```bash
        dotnet add package Azure.Storage.Blobs
        dotnet add package Azure.Identity
        ```
    - プロジェクトにデータフォルダーを作成する
        ```bash
        mkdir date
        ```

3. プロジェクトにコードを記述する
    `code Program.cs`でプログラムファイルを開き、編集する

    <details><summary>全コードを見る</summary>
    
    ```c#
    using Azure.Storage.Blobs;
    using Azure.Storage.Blobs.Models;
    using Azure.Identity;
    
    Console.WriteLine("Azure Blob Storage exercise\n");
    
    // Create a DefaultAzureCredentialOptions object to configure the DefaultAzureCredential
    DefaultAzureCredentialOptions options = new()
    {
        ExcludeEnvironmentCredential = true,
        ExcludeManagedIdentityCredential = true
    };
    
    // Run the examples asynchronously, wait for the results before proceeding
    await ProcessAsync();
    
    Console.WriteLine("\nPress enter to exit the sample application.");
    Console.ReadLine();
    
    async Task ProcessAsync()
    {
        // CREATE A BLOB STORAGE CLIENT
        // Create a credwntial using DefaultAzureCredential with configured options
        string accountName = "storageacct469511556"; // Replace with your storage account name
    
        // Use the DefaultAzureCredential with the options configred at the top of the program
        DefaultAzureCredential credential = new DefaultAzureCredential(options);
    
        // Create the BlobServiceClient using the endpoint and DefaultAzureCredential
        string blobServiceEndpoint = $"https://{accountName}.blob.core.windows.net";
        BlobServiceClient blobServiceClient = new BlobServiceClient(new Uri(blobServiceEndpoint), credential);
    
    
        // CREATE A CONTAINER
        // Create a unique name for the container
        string containerName = "wtblob" + Guid.NewGuid().ToString();
    
        // Create the container and return a container client object
        Console.WriteLine("Create container: "+ containerName);
        BlobContainerClient containerClinet = await blobServiceClient.CreateBlobContainerAsync(containerName);
    
        // Create if the container was created successfully
        if (containerClinet != null) {
            Console.WriteLine("Container created successfully, press 'Enter' to continue.");
            Console.ReadLine();
        } else {
            Console.WriteLine("Failed to create the container, exiting program.");
            return;
        }
    
    
        // CREATE A LOCAL FILE FOR UPLOAD TO BLOB STORAGE
        // Create a local file in the ./data/ directory uploading and downloading
        Console.WriteLine("Creating a local file for upload to Blob storage...");
        string localPath = "./data/";
        string fileName = "wtfile" + Guid.NewGuid().ToString() + ".txt";
        string localFilePath = Path.Combine(localPath, fileName);
    
        // Write text to the file
        await File.WriteAllTextAsync(localFilePath, "Hello, World");
        Console.WriteLine("Local file created, press 'Enter' to continue.");
        Console.ReadLine();
        
    
        // UPLOAD THE FILE TO BLOB STORAGE
        // Get a reference to the blob and upload the file
        BlobClient blobClient = containerClinet.GetBlobClient(fileName);
    
        Console.WriteLine("Uploading to Blob storage as blob:\n\t {0}", blobClient.Uri);
    
        // Open the file and upload its data
        using (FileStream uploadFileStream = File.OpenRead(localFilePath)){
            await blobClient.UploadAsync(uploadFileStream);
            uploadFileStream.Close();
        }
    
        // Verify if the file was uploaded successfully
        bool blobExists = await blobClient.ExistsAsync();
        if (blobExists) {
            Console.WriteLine("File uploaded successfully, press 'Enter' to continue.");
            Console.ReadLine();
        } else {
            Console.WriteLine("File uploaded failed, exiting program.");
            return;
        }
        
    
        // LIST BLOBS IN THE CONTAINER
        Console.WriteLine("Listing blobs in container...");
        await foreach (BlobItem blobItem in containerClinet.GetBlobsAsync()) {
            Console.WriteLine("/t" + blobItem.Name);
        }
    
        Console.WriteLine("Press 'Enter' to continue.");
        Console.ReadLine();
    
    
        // DOWNLOAD THE BLOB TO A LOCAL FILE
        // Add the string "DOWNLOAD" before the .txt extention so it doesn't
        // overwite the original file
        string downloadFilePath = localFilePath.Replace(".txt", "DOWNLOADED.txt");
    
        Console.WriteLine("Downloading blob to: {0}", downloadFilePath);
    
        // Download the blob's contants and save it to a file
        BlobDownloadInfo download = await blobClient.DownloadAsync();
    
        using (FileStream downloadFileStream = File.OpenWrite(downloadFilePath)) {
            await download.Content.CopyToAsync(downloadFileStream);
        }
    
        Console.WriteLine("Blob downloaded successfully to: {0}", downloadFilePath);
        
    }
    ```
    
    </details>
    

4. Azure にサインインしする
    `az login`を実行すると、黄文字で指示が出るので従いログインする
    指定のURLにアクセスし、認証コードを入力してログインする
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/9f4d7db2-95d4-4c35-9f49-2ee80f366278.png)

5. アプリを実行する
    `dotnet run`を実行する
    
    :::note warn
    初回実行時は権限エラー（AuthorizationPermissionMismatch）が発生しました。
    [ストレージアカウント] > [アクセス制御(IAM)] > [ロール割り当ての追加] から、ログインしたアカウントに対して**ストレージ BLOB データ共同作成者**を追加して再実行しました。
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/4e105e52-e95c-412e-b974-d72dc770e60b.png)

6. ファイルを確認する
    ストレージアカウントにコンテナー、Blobが作成され、ローカルにもダウンロードされていることを確認する
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/4a244623-1f53-4734-a9c0-a8fdf7998785.png)

7. リソースのクリーンアップ
    演習完了後は、不要な課金を防ぐためリソースグループごと削除してクリーンアップする

</details>

### Azure Cosmos DB

[演習 - .NET を使用して Azure Cosmos DB for NoSQL にリソースを作成する](https://learn.microsoft.com/ja-jp/training/modules/work-with-cosmos-db/3-exercise-work-cosmos-db-dotnet)

**概要:** Azure Cosmos DB アカウントを作成し、Microsoft Azure Cosmos DB SDK を使用してデータベース、コンテナー、サンプルアイテムを作成する .NET コンソール アプリケーションを構築する

::: note info
**試験対策:** SDK の主要クラスと代表メソッドまとめ
| クラス | 役割 | 代表メソッド | 使い方/注意点 |
|:-:|:-:|:-:|:-:|
| CosmosClient | Cosmos DB アカウント全体のエントリポイント。エンドポイントと認証で作成する。 | GetDatabase, CreateDatabaseIfNotExistsAsync, GetContainer | アカウント単位の操作（データベース作成・一覧）。 |
| Database | 特定データベースへの操作を提供するクライアント。 | CreateContainerIfNotExistsAsync, GetContainer | データベース内のコンテナ操作の開始点。CreateContainerIfNotExistsAsync は非同期で実行。 |
| Container | 特定コンテナへの操作を提供するクライアント。 | CreateItemAsync, ReadItemAsync, GetItemQueryIterator | コンテナ内のアイテム操作の開始点。CreateItemAsync は非同期で実行。 |
| ItemResponse<T> | アイテム操作の結果を表すジェネリッククラス。 | （プロパティ）Resource, StatusCode, RequestCharge | Resource プロパティで操作結果のアイテムを取得。RequestCharge で消費した RUs を確認可能。 |
:::

<details><summary>Cosmos DBへアイテムを格納する手順を見る</summary>

1. Azure Cosmos DB アカウントの作成
    - Azure Portal から新しいクラウドシェルを作成し、Bash を選択してクラシックバージョンに移動する（※[Azure App Service](#Azure-App-Service)の手順 1 と同様です）
    - リソースグループを作成する
        ```bash
        az group create --location japaneast --name myResourceGroup
        ```
    - 変数を設定する
        ```bash
        resourceGroup=myResourceGroup
        accountName=cosmosexercise$RANDOM
        ```
    - Azure Cosmos DB アカウントを作成する

        ```bash
        az provider register --namespace Microsoft.DocumentDB
        az cosmosdb create --name $accountName \
        --resource-group $resourceGroup
        ```
    リソースグループ配下にCosmos DB アカウントが作成される
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/1225c176-787d-41bb-82a7-274cf2b222d3.png)


    :::note warn
    プロバイダーを登録しないとエラーになる場合があります。
    作成には数分かかります。

2. Azure Cosmos DB アカウントの documentEndpoint・主キーを取得する

    - documetEndoiintの取得
        ```bash
        az cosmosdb show --name $accountName \
          --resource-group $resourceGroup \
          --query "documentEndpoint" --output tsv
        ```
    - 主キーの取得
        ```bash
        az cosmosdb keys list --name $accountName \
          --resource-group $resourceGroup \
          --query "primaryMasterKey" --output tsv
        ```

    :::note warn
    取得した値は後で使用するのでメモしておきます。
    主キーは機密情報なので、取り扱いに注意してください。

3. .NET コンソールアプリを作成する

    - プロジェクトを作成するディレクトリの作成し、.NET コンソールアプリケーションを作成する
        ```bash
        mkdir cosmosdb
        cd cosmosdb
        dotnet new console
        ```
    - アプリケーションに必要なパッケージを追加する
        ```bash
        dotnet add package Microsoft.Azure.Cosmos --version 3.*
        dotnet add package Newtonsoft.Json --version 13.*
        dotnet add package dotenv.net
        ```

4. 環境変数の設定
    - プロジェクトのルートディレクトリに `.env` ファイルを作成し、次の内容を記述する
        ```
        COSMOS_ENDPOINT="<手順 2 で取得した documentEndpoint の値>"
        COSMOS_KEY="<手順 2 で取得した 主キー の値>"
        ```

5. プロジェクトにコードを記述する
  `code Program.cs`でプログラムファイルを開き、編集する
    
    <details><summary>全コードを見る</summary>
    
    ```c#
    using Microsoft.Azure.Cosmos;
    using dotenv.net;
    
    string databaseName = "myDatabase"; // Name of the database to create or use
    string containerName = "myContainer"; // Name of the container to create or use
    
    // Load environment variables from .env file
    DotEnv.Load();
    var envVars = DotEnv.Read();
    string cosmosDbAccountUrl = envVars["DOCUMENT_ENDPOINT"];
    string accountKey = envVars["ACCOUNT_KEY"];
    
    if (string.IsNullOrEmpty(cosmosDbAccountUrl) || string.IsNullOrEmpty(accountKey))
    {
      Console.WriteLine("Please set the DOCUMENT_ENDPOINT and ACCOUNT_KEY environment variables.");
      return;
    }
    
    // CREATE THE COSMOS DB CLIENT USING THE ACCOUNT URL AND KEY
    CosmosClient client = new(
      accountEndpoint: cosmosDbAccountUrl,
      authKeyOrResourceToken: accountKey
    );
    
    
    try
    {
      // CREATE A DATABASE IF IT DOESN'T ALREADY EXIST
      Database database = await client.CreateDatabaseIfNotExistsAsync(databaseName);
      Console.WriteLine($"Create or retrieved database: {database.Id}");
    
    
      // CREATE A CONTAINER WITH A SPECIFIED PARTITION KEY
      Container container = await database.CreateContainerIfNotExistsAsync(
          id: containerName,
          partitionKeyPath: "/id"
      );
      Console.WriteLine($"Create or retrieved container: {container.Id}");
    
    
      // DEFINE A TYPED ITEM (PRODUCT) TO ADD TO THE CONTAINER
      Product newItem = new Product{
          id = Guid.NewGuid().ToString(),
          name = "Sample Item",
          description = "This is a sample item in my Azure Cosmos DB exercise."
      };
    
    
      // ADD THE ITEM TO THE CONTAINER
      ItemResponse<Product> createResponse = await container.CreateItemAsync(
          item: newItem,
          partitionKey: new PartitionKey(newItem.id)
      );
    
      Console.WriteLine($"Created item with ID: {createResponse.Resource.id}");
      Console.WriteLine($"Response charge: {createResponse.RequestCharge} RUs");
    
    }
    catch (CosmosException ex)
    {
      // Handle Cosmos DB-specific exceptions
      // Log the status code and error message for debugging
      Console.WriteLine($"Cosmos DB Error: {ex.StatusCode} - {ex.Message}");
    }
    catch (Exception ex)
    {
      // Handle general exceptions
      // Log the error message for debugging
      Console.WriteLine($"Error: {ex.Message}");
    }
    
    // This class represents a product in the Cosmos DB container
    public class Product
    {
      public string? id { get; set; }
      public string? name { get; set; }
      public string? description { get; set; }
    }
    ```
    
    </details>

6. ビルドエラーがないことを確認する
    `dotnet build`を実行する

7. アプリを実行する
    `dotnet run`を実行する
    以下のような出力になる

    ```plaintext
    Create or retrieved database: myDatabase
    Create or retrieved container: myContainer
    Created item with ID: 36ae1b38-bb60-4247-9cdf-17f341d6905e
    Response charge: 6.29 RUs
    ```

8. Azure Portal でアイテムを確認する
    Portal から Cosmos DB アカウントを開き、[データエクスプローラー] > [myDatabase] > [myContainer] > [item] を選択し、追加されたアイテムが存在することを確認する
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/1fdfab8f-b32c-460b-bacf-99f774079040.png)


9. リソースのクリーンアップ
    演習完了後は、不要な課金を防ぐためリソースグループごと削除してクリーンアップする

</details>

### Azure Container Registry

[演習 - Azure Container Registry タスクを使用してコンテナー イメージをビルドして実行する](https://learn.microsoft.com/ja-jp/training/modules/publish-container-image-to-azure-container-registry/6-build-run-image-azure-container-registry)

**概要:** アプリケーションコードからコンテナーイメージを作成し、Azure CLI を使用して Azure Container Registry にプッシュする

:::note info
**試験対策:** ACRの主要コマンドまとめ
| コマンド | 役割 | 使い方/注意点 |
|:-:|:-:|:-:|
| az acr create | ACRの作成 | `az acr create --resource-group <リソースグループ名> --name <ACR名> --sku Basic` で作成。名前は小文字・数値のみで、3～50文字の範囲。 |
| az acr build | ACRにイメージをビルド・プッシュ | `az acr build --image <イメージ名> --registry <ACR名> --file <Dockerfileパス> .` でビルド・プッシュ。 |
| az acr repository list | ACR内のリポジトリ一覧表示 | `az acr repository list --name <ACR名> --output table` で一覧表示。 |
| az acr repository show-tags | リポジトリ内のタグ一覧表示 | `az acr repository show-tags --name <ACR名> --repository <リポジトリ名> --output table` でタグ一覧表示。 |
| az acr run | ACRでイメージを実行 | `az acr run --registry <ACR名> --cmd '$Registry/<イメージ名>' /dev/null` でイメージを実行。 |
:::

:::note alert
**注意:** 無料試用期間のサブスクリプションでは、一部コマンドが実行できない場合があります。
:::

<details><summary>ACRにイメージをビルド・プッシュする手順を見る</summary>

1. Azure Container Registry の作成

   - Azure Portal から新しいクラウドシェルを作成し、Bash を選択してクラシックバージョンに移動する（※[Azure App Service](#Azure-App-Service)の手順 1 と同様です）
   - リソースグループを作成する
     ```bash
     az group create --location japaneast --name myResourceGroup
     ```
   - Azure Container Registry を作成する

     ```bash
     az provider register --namespace Microsoft.ContainerRegistry
     az acr create --resource-group myResourceGroup \
          --name acrexercise --sku Basic
     ```
    ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/42575c78-993b-4492-9e2d-fbc142197f3c.png)


    :::note warn
    Container Registryの名前は公式ドキュメントでは `myContainerRegistry` という名前ですが、小文字・数値のみで、3～50文字の範囲である必要があるため、`acrexercise` としています。

2. Dockerfile からイメージをビルドし、ACR にプッシュする

    - Dockerfile を作成する
        ```bash
        echo FROM mcr.microsoft.com/hello-world > Dockerfile
        ```

    - イメージをビルドし、ACR にプッシュする
        ```bash
        az acr build --image sample/hello-world:v1  \
          --registry acrexercise \
          --file Dockerfile .
        ```

3. 結果を確認する

    - レジストリ内のリポジトリを一覧表示する
        ```bash
        az acr repository list --name myContainerRegistry --output table
        ```
        ```text
        Result
        ----------------
        sample/hello-world
        ```
    - リポジトリのタグを一覧表示する
        ```bash
        az acr repository show-tags --name myContainerRegistry \
          --repository sample/hello-world --output table
        ```
        ```text
        Result
        ----------------
        v1
        ```

4. ACR でイメージを実行する
    - `az acr run` でイメージを実行する
        ```bash
        az acr run --registry acrexercise \
            --cmd '$Registry/sample/hello-world:v1' /dev/null
        ```

5. リソースのクリーンアップ
   演習完了後は、不要な課金を防ぐためリソースグループごと削除してクリーンアップする

</details>

### Azure Key Vault

[演習 - Azure Key Vault からシークレットを作成して取得する](https://learn.microsoft.com/ja-jp/training/modules/implement-azure-key-vault/5-set-retrieve-secret-azure-key-vault)

**概要:** Azure Key Vault を作成し、Azure CLI を使用してシークレットを保存し、Key Vault からシークレットを作成および取得できる .NET コンソール アプリケーションを構築する

<details><summary>Key Vaultにシークレットを保存し、取得する手順を見る</summary>

1. Azure Key Vault の作成
    - Azure Portal から新しいクラウドシェルを作成し、Bash を選択してクラシックバージョンに移動する（※[Azure App Service](#Azure-App-Service)の手順 1 と同様です）
    - リソースグループを作成する
        ```bash
        az group create --location japaneast --name myResourceGroup
        ```
    - 変数を設定する
        ```bash
        resourceGroup=myResourceGroup
        location=japaneast
        keyVaultName=mykeyvaultname$RANDOM
        ```
    - Azure Key Vault を作成する
        ```bash
        az provider register --namespace Microsoft.KeyVault
        az keyvault create --name $keyVaultName \
          --resource-group $resourceGroup \
          --location $location
        ```
        ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/736c391b-ae27-4209-9758-133fe1836495.png)


2. Microsoft Entraユーザー名に役割を割り当てる
    - userPrincipalNameを取得する
        ```bash
        userPrincipal=$(az rest --method GET --url https://graph.microsoft.com/v1.0/me \
            --headers 'Content-Type=application/json' \
            --query userPrincipalName --output tsv)
        ```
    - キーコンテナーのリソースIDを取得する
        ```bash
        resourceID=$(az keyvault show --resource-group $resourceGroup \
            --name $keyVaultName --query id --output tsv)
        ```
    - Key Vault Secrets Officerの役割を割り当てる
        ```bash
        az role assignment create --assignee $userPrincipal \
            --role "Key Vault Secrets Officer" \
            --scope $resourceID
        ```
        :::note info
        `Secrets Officer`の役割を割り当てることで、シークレットの設定、削除、および一覧表示の権限が付与されます。
        `Secrets User`の役割では、シークレットの取得と一覧表示が可能です。
        :::

3. シークレットを登録する
    - シークレットを登録する
        ```bash
        az keyvault secret set --vault-name $keyVaultName \
            --name "MySecret" --value "My secret value"
        ```
    - 登録したシークレットを確認する
        ```bash
        az keyvault secret show --name "MySecret" --vault-name $keyVaultName
        ```
        ![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4187508/8ad8e116-83f9-4f21-b607-edf59ba53415.png)


4. .NET コンソールアプリを作成する
    - プロジェクトを作成するディレクトリの作成し、.NET コンソールアプリケーションを作成する
        ```bash
        mkdir keyvault
        cd keyvault
        dotnet new console
        ```
    - アプリケーションに必要なパッケージを追加する
        ```bash
        dotnet add package Azure.Identity
        dotnet add package Azure.Security.KeyVault.Secrets
        ```

5. プロジェクトにコードを記述する
    `code Program.cs`でプログラムファイルを開き、編集する
    <details><summary>全コードを見る</summary>
    
    ```c#
    using Azure.Identity;
    using Azure.Security.KeyVault.Secrets;

    // Replace YOUR-KEYVAULT-NAME with your actual Key Vault name
    string KeyVaultUrl = "https://mykeyvaultname6235.vault.azure.net/";


    // ADD CODE TO CREATE A CLIENT
    // Configure authentication options for connecting to Azure Key Vault
    DefaultAzureCredentialOptions options = new(){
        ExcludeEnvironmentCredential = true,
        ExcludeManagedIdentityCredential = true
    };

    // Create the Key Vault client using the URL and Authentication Credential
    var client = new SecretClient(new Uri(KeyVaultUrl), new DefaultAzureCredential(options));


    // ADD CODE TO CREATE A MENU SYSTEM
    // Main application loop - continues untill user types 'quit'
    while(true){
        // Display menu options to the user
        Console.Clear();
        Console.WriteLine("/nPlease select an option");
        Console.WriteLine("1. Crate a new secret");
        Console.WriteLine("2. List all secrets");
        Console.WriteLine("Type `quit` to exit");
        Console.Write("Enter your choice: ");

        // Read user input and convert to lowercase for easier comparison
        string? input = Console.ReadLine()?.Trim().ToLower();

        // Check if user wants to exit the application
        if (input == "quit"){
            Console.WriteLine("Goodbye!");
            break;
        }

        // Process the user's manu selection
        switch (input){
            case "1":
                // Call the method to create a new secret
                await CreateSecretAsync(client);
                break;
            case "2":
                // Call the method to list all existing secrets
                await ListSecretsAsync(client);
                break;
            default:
                // Handle invalid input
                Console.WriteLine("Invalid option. Please enter 1, 2, or 'quit");
                break;
        }
    }


    // ADD CODE TO CREATE A SECRET
    async Task CreateSecretAsync(SecretClient client)
    {
        try
        {
            Console.Clear();
            Console.WriteLine("\nCreating a new secret...");
            
            // Get the secret name from user input
            Console.Write("Enter secret name: ");
            string? secretName = Console.ReadLine()?.Trim();

            // Validate that the secret name is not empty
            if (string.IsNullOrEmpty(secretName))
            {
                Console.WriteLine("Secret name cannot be empty.");
                return;
            }
            
            // Get the secret value from user input
            Console.Write("Enter secret value: ");
            string? secretValue = Console.ReadLine()?.Trim();

            // Validate that the secret value is not empty
            if (string.IsNullOrEmpty(secretValue))
            {
                Console.WriteLine("Secret value cannot be empty.");
                return;
            }

            // Create a new KeyVaultSecret object with the provided name and value
            var secret = new KeyVaultSecret(secretName, secretValue);
            
            // Store the secret in Azure Key Vault
            await client.SetSecretAsync(secret);

            Console.WriteLine($"Secret '{secretName}' created successfully!");
            Console.WriteLine("Press Enter to continue...");
            Console.ReadLine();
        }
        catch (Exception ex)
        {
            // Handle any errors that occur during secret creation
            Console.WriteLine($"Error creating secret: {ex.Message}");
        }
    }


    // ADD CODE TO LIST SECRETS
    async Task ListSecretsAsync(SecretClient client)
    {
        try
        {
            Console.Clear();
            Console.WriteLine("Listing all secrets in the Key Vault...");
            Console.WriteLine("----------------------------------------");

            // Get an async enumerable of all secret properties in the Key Vault
            var secretProperties = client.GetPropertiesOfSecretsAsync();
            bool hasSecrets = false;

            // Iterate through each secret property to retrieve full secret details
            await foreach (var secretProperty in secretProperties)
            {
                hasSecrets = true;
                try
                {
                    // Retrieve the actual secret value and metadata using the secret name
                    var secret = await client.GetSecretAsync(secretProperty.Name);
                    
                    // Display the secret information to the console
                    Console.WriteLine($"Name: {secret.Value.Name}");
                    Console.WriteLine($"Value: {secret.Value.Value}");
                    Console.WriteLine($"Created: {secret.Value.Properties.CreatedOn}");
                    Console.WriteLine("----------------------------------------");
                }
                catch (Exception ex)
                {
                    // Handle errors for individual secrets (e.g., access denied, secret not found)
                    Console.WriteLine($"Error retrieving secret '{secretProperty.Name}': {ex.Message}");
                    Console.WriteLine("----------------------------------------");
                }
            }

            // Inform user if no secrets were found in the Key Vault
            if (!hasSecrets)
            {
                Console.WriteLine("No secrets found in the Key Vault.");
            }
        }
        catch (Exception ex)
        {
            // Handle general errors that occur during the listing operation
            Console.WriteLine($"Error listing secrets: {ex.Message}");
        
        }
        Console.WriteLine("Press Enter to continue...");
        Console.ReadLine();
    }
    ```

    </details>

6. Azureにサインインしてアプリを実行する
    - `az login`を実行すると、黄文字で指示が出るので従いログインする
    - `dotnet run`を実行する
    - メニューが表示されるので、1を入力してEnterキーを押す
    - シークレット名と値を入力し、Enterキーを押す
    - 成功メッセージが表示されるので、Enterキーを押す
    - メニューが再度表示されるので、2を入力してEnterキーを押す
    - 登録したシークレットが表示されるので、Enterキーを押す
    - メニューが再度表示されるので、`quit`と入力してEnterキーを押す

7. リソースのクリーンアップ
    演習完了後は、不要な課金を防ぐためリソースグループごと削除してクリーンアップする

</details>

### Azure App Configration

[演習 - Azure App Configuration から構成設定を取得する](https://learn.microsoft.com/ja-jp/training/modules/implement-azure-app-configuration/5a-retrieve-configuration-settings)

**概要:** 

### Azure API Management

[演習 - Azure API Management を使用して API をインポートして構成する](https://learn.microsoft.com/ja-jp/training/modules/explore-api-management/8-exercise-import-api)

**概要:**

### Azure Event Grid

[演習 - Event Grid を使用してカスタム エンドポイントにイベントをルーティングする](https://learn.microsoft.com/ja-jp/training/modules/azure-event-grid/8-event-grid-custom-events)

**概要:**

### Azure Event Hubs

[演習 - Azure Event Hubs からイベントを送信および取得する](https://learn.microsoft.com/ja-jp/training/modules/azure-event-hubs/6a-event-hubs-send-receive)

**概要:**

### Azure Queue Storage

[演習 - Azure Queue Storage からメッセージを送受信する](https://learn.microsoft.com/ja-jp/training/modules/discover-azure-message-queue/8a-send-receive-messages-queue-storage)

**概要:**

### Application Insights

[演習 - 自動インストルメンテーションを使用してアプリケーションを監視する](https://learn.microsoft.com/ja-jp/training/modules/monitor-app-performance/6a-monitor-application-instrumentation)

**概要:**

## まとめ

AZ204の公式ドキュメントの演習をまとめました。
Azureの各サービスを実際に操作しながら学習できるので、試験対策として非常に有効だと思います。
ぜひ一度試してみてください。
